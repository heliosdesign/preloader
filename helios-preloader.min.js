var heliosPreloader=function(){var parallel_max=5,parallel_current=0,manifest={},index={},loaded={},events={},complete={},on=function(type,callback){events[type]=events[type]||[],events[type].push(callback)},trigger=function(type){if(events[type])for(var args=Array.prototype.slice.call(arguments,1),i=0,l=events[type].length;l>i;i++)"function"==typeof events[type][i]&&events[type][i].apply(this,args)},add=function(set,path,filename){manifest[set]||(manifest[set]=[],index[set]=-1,loaded[set]=0,complete[set]=!1),manifest[set].push({path:path,filename:filename,ready:!1})},start=function(set){console.log('[Preloader] start "%s" -> %O',set,manifest[set]),load(set)},load=function(set){if(parallel_current++,index[set]++,!(index[set]>=manifest[set].length)){{var file=manifest[set][index[set]];$.get(file.path).done(function(){if(file.ready=!0,file.callback&&(file.callback(),file.callback=void 0),loaded[set]+=1,loaded[set]>=manifest[set].length){if(complete[set])return;return console.log('[Preloader] set "%s" complete %s/%s',set,loaded[set],manifest[set].length),complete[set]=!0,void trigger(set+"-complete")}parallel_current--,load(set)}).fail(function(){console.warn(file.path+" FAILED"),parallel_current--,load(set)})}parallel_max>parallel_current&&load(set)}},whenReady=function(opts){if("function"==typeof opts.callback&&manifest[opts.set])if(opts.file){for(var file,i=manifest[opts.set].length-1;i>=0;i--)if(manifest[opts.set][i].filename===opts.file){file=manifest[opts.set][i];break}if(!file)return void console.warn('Canâ€™t add ready callback, no file filed "%s" exists.',opts.file);file.ready===!0?opts.callback():file.callback=opts.callback}else complete[opts.set]===!0?opts.callback():on(opts.set+"-complete",opts.callback)};return{start:start,add:add,whenReady:whenReady,complete:complete}};